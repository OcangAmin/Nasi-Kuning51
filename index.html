<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>POS Kasir Nasi Kuning 51</title>
<style>
  body{
    margin:0;
    font-family: Arial, sans-serif;
    background:#f2f2f2;
  }
  .container{
    max-width: 420px;
    margin:0 auto;
    padding:10px;
  }
  .header{
    text-align:center;
    padding:12px 0;
    background:#fff;
    border-radius:8px;
    box-shadow:0 1px 4px rgba(0,0,0,0.1);
    margin-bottom:10px;
  }
  .title{
    font-size:18px;
    font-weight:700;
  }
  .section{
    background:#fff;
    border-radius:8px;
    padding:10px;
    margin-bottom:10px;
    box-shadow:0 1px 4px rgba(0,0,0,0.1);
  }
  .section h3{
    margin:0 0 8px 0;
    font-size:14px;
    font-weight:700;
  }

  /* MENU GRID */
  .btn-grid{
    display:grid;
    grid-template-columns: repeat(2, 1fr);
    gap:8px;
  }
  .btn{
    padding:12px;
    border:none;
    border-radius:8px;
    font-weight:700;
    font-size:13px;
    cursor:pointer;
    background:#1a73e8;
    color:#fff;
    text-align:left;
  }
  .btn.secondary{
    background:#34a853;
  }
  .btn.danger{
    background:#ea4335;
  }
  .btn.gray{
    background:#777;
  }
  .btn.small-btn{
    padding:8px;
    font-size:12px;
    border-radius:8px;
  }

  /* CART */
  .cart{
    max-height: 220px;
    overflow:auto;
  }
  .cart-item{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:8px 0;
    border-bottom:1px solid #eee;
  }
  .cart-item div{
    display:flex;
    align-items:center;
    gap:8px;
  }
  .qty{
    display:flex;
    align-items:center;
    gap:4px;
  }
  .qty button{
    padding:4px 8px;
    border:none;
    border-radius:6px;
    cursor:pointer;
  }

  /* FOOTER FIXED */
  .footer{
    position: fixed;
    bottom:0;
    left:0;
    right:0;
    background:#fff;
    padding:10px;
    box-shadow:0 -2px 8px rgba(0,0,0,0.15);
  }
  .footer .row{
    display:flex;
    gap:8px;
  }
  .footer input[type=number]{
    width:100%;
    padding:10px;
    border-radius:8px;
    border:1px solid #ccc;
    font-size:14px;
  }
  .footer .summary{
    display:flex;
    justify-content:space-between;
    margin-top:8px;
    font-weight:700;
  }
  .footer .btn-grid{
    grid-template-columns: repeat(3, 1fr);
    margin-top:8px;
  }
  .footer .btn{
    padding:10px;
  }

  .history{
    max-height: 220px;
    overflow:auto;
  }
  .history-item{
    padding:8px;
    border-bottom:1px solid #eee;
  }
  .history-item div{
    font-size:12px;
  }
  .info{
    font-size:12px;
    color:#555;
    margin-top:6px;
  }
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <div class="title">POS Kasir Nasi Kuning 51</div>
    <div style="font-size:12px; color:#555;">Tampilan POS untuk HP (fit & cepat)</div>
  </div>

  <!-- MENU -->
  <div class="section">
    <h3>Menu Utama</h3>
    <div class="btn-grid">
      <button class="btn" onclick="addItem('Nasi kuning ayam',15000)">Nasi kuning ayam - 15.000</button>
      <button class="btn" onclick="addItem('Nasi kuning ikan',13000)">Nasi kuning ikan - 13.000</button>
      <button class="btn" onclick="addItem('Nasi kuning telur',10000)">Nasi kuning telur - 10.000</button>
      <button class="btn" onclick="addItem('Nasi kuning ayam telur',23000)">Nasi kuning ayam telur - 23.000</button>
      <button class="btn" onclick="addItem('Nasi kuning ikan telur',20000)">Nasi kuning ikan telur - 20.000</button>
    </div>
  </div>

  <div class="section">
    <h3>Menu Additional</h3>
    <div class="btn-grid">
      <button class="btn secondary" onclick="addItem('Ikan',5000)">Ikan - 5.000</button>
      <button class="btn secondary" onclick="addItem('Bakwan',2000)">Bakwan - 2.000</button>
      <button class="btn secondary" onclick="addItem('Nasi',5000)">Nasi - 5.000</button>
      <button class="btn secondary" onclick="addItem('Telur',5000)">Telur - 5.000</button>
      <button class="btn secondary" onclick="addItem('Ayam',5000)">Ayam - 5.000</button>
      <button class="btn secondary" onclick="addItem('Air mineral',5000)">Air mineral - 5.000</button>
    </div>
  </div>

  <!-- CART -->
  <div class="section">
    <h3>Pesanan</h3>
    <div class="cart" id="cart"></div>
    <div class="summary">
      <div>Total Item: <span id="totalItem">0</span></div>
      <div>Total Harga: <span id="totalPrice">0</span></div>
    </div>
  </div>

  <!-- HISTORY -->
  <div class="section">
    <h3>History Penjualan</h3>
    <div class="history" id="history"></div>
    <div class="row" style="margin-top:8px;">
      <button class="btn" onclick="saveHistory()">Simpan History</button>
      <button class="btn danger" onclick="closeCashier()">Tutup Kasir</button>
    </div>
    <div class="row" style="margin-top:8px;">
      <button class="btn gray" onclick="resetHistory()">Reset History</button>
    </div>
    <div class="info">Reset history akan menghapus semua riwayat penjualan.</div>
  </div>
</div>

<!-- FOOTER FIXED -->
<div class="footer">
  <div class="row">
    <button class="btn" onclick="setPayment('cash')">CASH</button>
    <button class="btn" onclick="setPayment('qris')">QRIS</button>
  </div>

  <div class="row" style="margin-top:8px;">
    <input id="paid" type="number" placeholder="Uang Bayar" inputmode="numeric" oninput="calc()">
    <button class="btn gray" onclick="clearPaid()">Clear</button>
  </div>

  <div class="btn-grid">
    <button class="btn small-btn" onclick="addPaid(5000)">5K</button>
    <button class="btn small-btn" onclick="addPaid(10000)">10K</button>
    <button class="btn small-btn" onclick="addPaid(20000)">20K</button>
    <button class="btn small-btn" onclick="addPaid(50000)">50K</button>
    <button class="btn small-btn" onclick="addPaid(100000)">100K</button>
    <button class="btn small-btn" onclick="setPaidExact()">Uang Pas</button>
  </div>

  <div class="summary">
    <div>Status: <span id="status">Belum ada pesanan</span></div>
    <div>Kembalian: <span id="change">0</span></div>
  </div>

  <div class="row" style="margin-top:8px;">
    <button class="btn secondary" onclick="finishTransaction()">Selesaikan</button>
    <button class="btn gray" onclick="resetTransaction()">Reset</button>
  </div>
</div>

<script>
  let cart = [];
  let history = [];
  let paymentMethod = null;

  function loadData(){
    cart = JSON.parse(localStorage.getItem("bucek_cart")) || [];
    history = JSON.parse(localStorage.getItem("bucek_history")) || [];
    renderCart();
    renderHistory();
  }

  function saveData(){
    localStorage.setItem("bucek_cart", JSON.stringify(cart));
    localStorage.setItem("bucek_history", JSON.stringify(history));
  }

  function addItem(name, price){
    let idx = cart.findIndex(x => x.name === name);
    if(idx >= 0){
      cart[idx].qty++;
    } else {
      cart.push({name, price, qty:1});
    }
    renderCart();
    calc();
    saveData();
  }

  function removeItem(name){
    cart = cart.filter(x => x.name !== name);
    renderCart();
    calc();
    saveData();
  }

  function changeQty(name, delta){
    let idx = cart.findIndex(x => x.name === name);
    if(idx < 0) return;
    cart[idx].qty += delta;
    if(cart[idx].qty < 1) cart[idx].qty = 1;
    renderCart();
    calc();
    saveData();
  }

  function renderCart(){
    let html = "";
    let totalItem = 0;
    let totalPrice = 0;
    cart.forEach(item => {
      totalItem += item.qty;
      totalPrice += item.qty * item.price;
      html += `
        <div class="cart-item">
          <div>
            <strong>${item.name}</strong>
            <div class="qty">
              <button onclick="changeQty('${item.name}', -1)">-</button>
              <span>${item.qty}</span>
              <button onclick="changeQty('${item.name}', 1)">+</button>
            </div>
          </div>
          <div>
            <span>${item.qty * item.price}</span>
            <button class="btn small-btn danger" onclick="removeItem('${item.name}')">X</button>
          </div>
        </div>
      `;
    });
    document.getElementById("cart").innerHTML = html;
    document.getElementById("totalItem").innerText = totalItem;
    document.getElementById("totalPrice").innerText = totalPrice;
  }

  function setPayment(method){
    paymentMethod = method;
    if(method === "qris"){
      document.getElementById("paid").value = document.getElementById("totalPrice").innerText;
    }
    calc();
  }

  function addPaid(amount){
    let paidInput = document.getElementById("paid");
    let val = Number(paidInput.value || 0);
    paidInput.value = val + amount;
    calc();
  }

  function setPaidExact(){
    let total = Number(document.getElementById("totalPrice").innerText);
    document.getElementById("paid").value = total;
    calc();
  }

  function clearPaid(){
    document.getElementById("paid").value = "";
    calc();
  }

  function calc(){
    let total = Number(document.getElementById("totalPrice").innerText);
    let paid = Number(document.getElementById("paid").value || 0);

    if(cart.length === 0){
      document.getElementById("status").innerText = "Belum ada pesanan";
      document.getElementById("change").innerText = 0;
      return;
    }

    if(!paymentMethod){
      document.getElementById("status").innerText = "Pilih metode pembayaran";
      document.getElementById("change").innerText = 0;
      return;
    }

    if(paid < total){
      document.getElementById("status").innerText = "Uang kurang";
      document.getElementById("change").innerText = 0;
      return;
    }

    document.getElementById("status").innerText = "Siap bayar";
    document.getElementById("change").innerText = paid - total;
  }

  function finishTransaction(){
    let total = Number(document.getElementById("totalPrice").innerText);
    let paid = Number(document.getElementById("paid").value || 0);
    let change = Number(document.getElementById("change").innerText || 0);

    if(cart.length === 0){
      alert("Belum ada pesanan!");
      return;
    }
    if(!paymentMethod){
      alert("Pilih metode pembayaran!");
      return;
    }
    if(paid < total){
      alert("Uang tidak mencukupi!");
      return;
    }

    let now = new Date();
    let timestamp = now.toLocaleString();

    history.push({
      time: timestamp,
      items: JSON.parse(JSON.stringify(cart)),
      total,
      method: paymentMethod,
      paid,
      change
    });

    cart = [];
    paymentMethod = null;
    document.getElementById("paid").value = "";
    renderCart();
    renderHistory();
    calc();
    saveData();
  }

  function resetTransaction(){
    if(cart.length === 0){
      alert("Tidak ada transaksi untuk di-reset.");
      return;
    }

    let confirmReset = confirm("Yakin ingin reset transaksi saat ini? Data pesanan akan hilang.");
    if(!confirmReset) return;

    cart = [];
    paymentMethod = null;
    document.getElementById("paid").value = "";
    renderCart();
    calc();
    saveData();
  }

  function renderHistory(){
    let html = "";
    history.forEach((h, idx) => {
      let itemList = h.items.map(i => `${i.name} x${i.qty}`).join(", ");
      html += `
        <div class="history-item">
          <div><strong>#${idx+1} - ${h.time}</strong></div>
          <div>${itemList}</div>
          <div>Total: ${h.total} | Bayar: ${h.paid} | Kembali: ${h.change} | Metode: ${h.method.toUpperCase()}</div>
        </div>
      `;
    });
    document.getElementById("history").innerHTML = html;
  }

  function saveHistory(){
    if(history.length === 0){
      alert("Belum ada history transaksi!");
      return;
    }

    let text = "HISTORY TRANSAKSI\n\n";
    history.forEach((h, idx) => {
      let itemList = h.items.map(i => `${i.name} x${i.qty}`).join(", ");
      text += `#${idx+1} | ${h.time}\n`;
      text += `Items: ${itemList}\n`;
      text += `Total: ${h.total} | Bayar: ${h.paid} | Kembali: ${h.change} | Metode: ${h.method.toUpperCase()}\n\n`;
    });

    let blob = new Blob([text], {type:"text/plain"});
    let link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = `bucek_history_${new Date().getTime()}.txt`;
    link.click();
    URL.revokeObjectURL(link.href);
  }

  function resetHistory(){
    if(history.length === 0){
      alert("History kosong.");
      return;
    }

    let confirmReset = confirm("Yakin ingin reset semua history? Data riwayat akan hilang.");
    if(!confirmReset) return;

    history = [];
    saveData();
    renderHistory();
  }

  function closeCashier(){
    if(history.length === 0){
      alert("Belum ada transaksi untuk ditutup!");
      return;
    }

    let now = new Date();
    let filename = `bucek_tutup_kasir_${now.getFullYear()}-${now.getMonth()+1}-${now.getDate()}_${now.getHours()}-${now.getMinutes()}-${now.getSeconds()}.txt`;

    let text = "TUTUP KASIR\n\n";
    text += `Tanggal: ${now.toLocaleString()}\n`;
    text += `Total Transaksi: ${history.length}\n\n`;
    history.forEach((h, idx) => {
      let itemList = h.items.map(i => `${i.name} x${i.qty}`).join(", ");
      text += `#${idx+1} | ${h.time}\n`;
      text += `Items: ${itemList}\n`;
      text += `Total: ${h.total} | Bayar: ${h.paid} | Kembali: ${h.change} | Metode: ${h.method.toUpperCase()}\n\n`;
    });

    let blob = new Blob([text], {type:"text/plain"});
    let link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = filename;
    link.click();
    URL.revokeObjectURL(link.href);

    history = [];
    saveData();
    renderHistory();
    alert("Kasir ditutup dan history ter-reset.");
  }

  loadData();
  calc();
</script>

</body>
</html>
