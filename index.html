<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>POS HP - Bucek</title>
<style>
  :root{
    --bg:#F4F6F7;
    --card:#FFFFFF;
    --text:#1F2A3A;
    --muted:#6B7785;
    --border:#D6DDE5;
    --primary:#1F7A8C;
    --danger:#D9534F;
    --success:#2ECC71;
    --warning:#F39C12;
  }

  body{
    margin:0;
    font-family: Arial, sans-serif;
    background:var(--bg);
    color:var(--text);
  }

  .container{
    max-width: 480px;
    margin: 0 auto;
    padding: 12px;
  }

  .tab{
    display:flex;
    gap:10px;
    margin-bottom:12px;
  }

  .tab button{
    flex:1;
    padding:12px;
    border:none;
    border-radius:8px;
    background:#fff;
    border:1px solid var(--border);
    cursor:pointer;
    font-weight:600;
  }

  .tab button.active{
    background:var(--primary);
    color:#fff;
  }

  .card{
    background:var(--card);
    border:1px solid var(--border);
    border-radius:12px;
    padding:12px;
    margin-bottom:12px;
  }

  .grid{
    display:grid;
    grid-template-columns: repeat(2, 1fr);
    gap:8px;
  }

  .menu-btn{
    padding:12px;
    border:none;
    border-radius:10px;
    cursor:pointer;
    background:#fff;
    border:1px solid var(--border);
    text-align:left;
    font-weight:700;
  }

  .menu-btn span{
    display:block;
    font-size:12px;
    color:var(--muted);
  }

  .cart{
    margin-top:12px;
  }

  .cart-item{
    display:flex;
    justify-content:space-between;
    gap:10px;
    padding:8px 0;
    border-bottom:1px solid var(--border);
  }

  .cart-item:last-child{
    border-bottom:none;
  }

  .cart-item div{
    flex:1;
  }

  .cart-item .qty{
    width:36px;
    text-align:center;
  }

  .input-group{
    display:flex;
    gap:8px;
    margin-top:10px;
  }

  input[type="number"]{
    flex:1;
    padding:10px;
    border-radius:10px;
    border:1px solid var(--border);
    font-size:16px;
  }

  .small-btn{
    padding:10px 12px;
    border:none;
    border-radius:10px;
    cursor:pointer;
    background:var(--primary);
    color:#fff;
    font-weight:700;
  }

  .small-btn.secondary{
    background:var(--muted);
  }

  .footer-btns{
    display:flex;
    gap:8px;
    margin-top:12px;
  }

  .btn-danger{
    background:var(--danger);
  }

  .btn-success{
    background:var(--success);
  }

  .hide{display:none;}

  /* QRIS Popup */
  .popup-overlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.25);
    display:flex;
    justify-content:center;
    align-items:center;
    z-index:999;
  }
  .popup{
    width:90%;
    max-width:360px;
    background:#fff;
    border-radius:14px;
    padding:16px;
    border:1px solid #ddd;
  }
  .popup h3{
    margin-top:0;
    margin-bottom:8px;
  }

  /* History */
  .history-item{
    padding:10px;
    border:1px solid var(--border);
    border-radius:10px;
    margin-bottom:8px;
  }

</style>
</head>
<body>

<div class="container">

  <div class="tab">
    <button class="active" id="tabTransaksi" onclick="showTab('transaksi')">TRANSAKSI</button>
    <button id="tabRiwayat" onclick="showTab('riwayat')">RIWAYAT TRANSAKSI</button>
  </div>

  <!-- TRANSAKSI -->
  <div id="tabContentTransaksi">
    <div class="card">
      <div style="font-weight:700; margin-bottom:8px;">MENU UTAMA</div>
      <div class="grid" id="menuUtama"></div>
    </div>

    <div class="card">
      <div style="font-weight:700; margin-bottom:8px;">TAMBAHAN</div>
      <div class="grid" id="menuTambahan"></div>
    </div>

    <div class="card cart">
      <div style="font-weight:700;">PESANAN</div>
      <div id="cartList"></div>
      <div style="display:flex; justify-content:space-between; margin-top:10px;">
        <div style="font-weight:700;">TOTAL</div>
        <div style="font-weight:700;" id="totalHarga">0</div>
      </div>

      <div class="input-group">
        <input type="number" id="uangBayar" placeholder="Uang Bayar" oninput="calculateChange()" />
        <button class="small-btn" onclick="setQuick(5000)">5K</button>
        <button class="small-btn" onclick="setQuick(10000)">10K</button>
        <button class="small-btn" onclick="setQuick(20000)">20K</button>
        <button class="small-btn" onclick="setQuick(50000)">50K</button>
        <button class="small-btn" onclick="setQuick(100000)">100K</button>
      </div>

      <div style="display:flex; gap:8px; margin-top:10px;">
        <button class="small-btn secondary" onclick="clearUangBayar()">CLEAR</button>
        <button class="small-btn" onclick="setExact()">UANG PAS</button>
      </div>

      <div style="margin-top:10px;">
        <div style="font-weight:700;">KEMBALIAN</div>
        <div id="kembalian">0</div>
      </div>

      <div class="footer-btns">
        <button class="small-btn secondary" onclick="resetTransaction()">RESET TRANSAKSI</button>
        <button class="small-btn btn-danger" onclick="resetHistory()">RESET RIWAYAT</button>
        <button class="small-btn btn-success" onclick="finishTransaction()">SELESAIKAN TRANSAKSI</button>
      </div>
    </div>
  </div>

  <!-- RIWAYAT -->
  <div id="tabContentRiwayat" class="hide">
    <div class="card">
      <div style="font-weight:700;">RIWAYAT TRANSAKSI</div>
      <div id="historyList"></div>
    </div>
  </div>

</div>

<!-- QRIS POPUP -->
<div id="qrisPopup" class="hide">
  <div class="popup-overlay">
    <div class="popup">
      <h3>Konfirmasi QRIS</h3>
      <p>Apakah pembayaran QRIS sudah berhasil?</p>
      <button class="small-btn" onclick="qrisConfirmSuccess()">QRIS BERHASIL</button>
      <button class="small-btn btn-danger" onclick="qrisConfirmFail()">QRIS GAGAL</button>
      <button class="small-btn secondary" onclick="closeQrisPopup()">BATAL</button>
    </div>
  </div>
</div>

<script>
  const menuUtamaData = [
    {name:"NASI KUNING AYAM", price:15000},
    {name:"NASI KUNING IKAN", price:13000},
    {name:"NASI KUNING TELUR", price:10000},
    {name:"NASI KUNING AYAM TELUR", price:23000},
    {name:"NASI KUNING IKAN TELUR", price:20000},
    {name:"AIR MINERAL", price:5000}
  ];

  const menuTambahanData = [
    {name:"IKAN", price:5000},
    {name:"BAKWAN", price:2000},
    {name:"NASI", price:5000},
    {name:"TELUR", price:5000},
    {name:"AYAM", price:5000}
  ];

  let cart = [];
  let history = JSON.parse(localStorage.getItem("historyBucek") || "[]");

  function showTab(tab){
    document.getElementById("tabContentTransaksi").classList.toggle("hide", tab !== "transaksi");
    document.getElementById("tabContentRiwayat").classList.toggle("hide", tab !== "riwayat");
    document.getElementById("tabTransaksi").classList.toggle("active", tab === "transaksi");
    document.getElementById("tabRiwayat").classList.toggle("active", tab === "riwayat");
    renderHistory();
  }

  function renderMenu(){
    const menuUtama = document.getElementById("menuUtama");
    const menuTambahan = document.getElementById("menuTambahan");
    menuUtama.innerHTML="";
    menuTambahan.innerHTML="";

    menuUtamaData.forEach(item => {
      menuUtama.innerHTML += `
        <button class="menu-btn" onclick="addToCart('${item.name}', ${item.price})">
          ${item.name}
          <span>${item.price}</span>
        </button>`;
    });

    menuTambahanData.forEach(item => {
      menuTambahan.innerHTML += `
        <button class="menu-btn" onclick="addToCart('${item.name}', ${item.price})">
          ${item.name}
          <span>${item.price}</span>
        </button>`;
    });
  }

  function addToCart(name, price){
    const idx = cart.findIndex(i => i.name === name);
    if(idx > -1) cart[idx].qty++;
    else cart.push({name, price, qty:1});
    renderCart();
  }

  function renderCart(){
    const cartList = document.getElementById("cartList");
    cartList.innerHTML="";
    let total=0;
    cart.forEach(item => {
      total += item.price * item.qty;
      cartList.innerHTML += `
        <div class="cart-item">
          <div>${item.name}</div>
          <div class="qty">${item.qty}</div>
          <div>${item.price * item.qty}</div>
          <div>
            <button onclick="removeFromCart('${item.name}')">X</button>
          </div>
        </div>
      `;
    });
    document.getElementById("totalHarga").innerText = total;
    calculateChange();
  }

  function removeFromCart(name){
    cart = cart.filter(i => i.name !== name);
    renderCart();
  }

  function calculateChange(){
    const total = Number(document.getElementById("totalHarga").innerText || 0);
    const bayar = Number(document.getElementById("uangBayar").value || 0);
    const change = bayar - total;
    document.getElementById("kembalian").innerText = change < 0 ? 0 : change;
  }

  function setQuick(amount){
    const input = document.getElementById("uangBayar");
    input.value = Number(input.value || 0) + amount;
    calculateChange();
  }

  function clearUangBayar(){
    document.getElementById("uangBayar").value = "";
    calculateChange();
  }

  function setExact(){
    const total = Number(document.getElementById("totalHarga").innerText || 0);
    document.getElementById("uangBayar").value = total;
    calculateChange();
  }

  function resetTransaction(){
    if(confirm("Reset transaksi saat ini?")){
      cart=[];
      renderCart();
      clearUangBayar();
    }
  }

  function resetHistory(){
    if(confirm("Reset riwayat transaksi?")){
      history=[];
      localStorage.setItem("historyBucek", JSON.stringify(history));
      renderHistory();
    }
  }

  function finishTransaction(){
    const total = Number(document.getElementById("totalHarga").innerText || 0);
    const bayar = Number(document.getElementById("uangBayar").value || 0);

    if(total === 0){
      alert("Tidak ada transaksi.");
      return;
    }

    if(bayar < total){
      alert("Uang bayar tidak mencukupi!");
      return;
    }

    // QRIS popup
    if(confirm("Metode pembayaran QRIS?")){
      openQrisPopup();
      return;
    }

    saveTransaction("CASH");
  }

  function saveTransaction(method){
    const total = Number(document.getElementById("totalHarga").innerText || 0);
    const bayar = Number(document.getElementById("uangBayar").value || 0);
    const change = bayar - total;

    const transaction = {
      time: new Date().toLocaleString(),
      items: cart,
      total,
      bayar,
      change,
      method
    };

    history.push(transaction);
    localStorage.setItem("historyBucek", JSON.stringify(history));
    renderHistory();
    resetTransaction();
    alert("Transaksi berhasil disimpan.");
  }

  function renderHistory(){
    const list = document.getElementById("historyList");
    list.innerHTML="";
    history.forEach((t, idx) => {
      list.innerHTML += `
        <div class="history-item">
          <div><b>#${idx+1}</b> ${t.time}</div>
          <div>Total: ${t.total}</div>
          <div>Bayar: ${t.bayar}</div>
          <div>Kembali: ${t.change}</div>
          <div>Metode: ${t.method}</div>
        </div>
      `;
    });
  }

  // QRIS Popup
  function openQrisPopup(){
    document.getElementById("qrisPopup").classList.remove("hide");
  }
  function closeQrisPopup(){
    document.getElementById("qrisPopup").classList.add("hide");
  }
  function qrisConfirmSuccess(){
    closeQrisPopup();
    saveTransaction("QRIS");
  }
  function qrisConfirmFail(){
    closeQrisPopup();
    alert("QRIS gagal. Silakan coba lagi.");
  }

  renderMenu();
  renderCart();
  renderHistory();
</script>

</body>
</html>
