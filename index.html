<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>POS Kasir Nasi Kuning 51</title>
<style>
  :root{
    --bg:#0b1220;
    --card:#0f1a2b;
    --text:#f4f7ff;
    --muted:#a8b2c8;
    --accent:#7c3aed;
    --danger:#ff3b3b;
    --success:#22c55e;
    --border:rgba(255,255,255,0.12);
  }
  *{box-sizing:border-box;}
  body{
    margin:0;
    font-family: Arial, sans-serif;
    background:var(--bg);
    color:var(--text);
  }
  .container{
    max-width: 420px;
    margin: 0 auto;
    padding: 10px;
  }
  .header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:10px 0;
  }
  .tabs{
    display:flex;
    gap:10px;
  }
  .tab{
    padding:10px 12px;
    border-radius:10px;
    background:var(--card);
    border:1px solid var(--border);
    cursor:pointer;
    font-weight:600;
  }
  .tab.active{
    background:var(--accent);
    border-color:rgba(124,58,237,0.8);
  }
  .section{
    margin-top:10px;
  }
  .card{
    background:var(--card);
    border:1px solid var(--border);
    border-radius:12px;
    padding:10px;
  }
  .grid{
    display:grid;
    grid-template-columns: repeat(2, 1fr);
    gap:8px;
  }
  .menu-btn{
    background:rgba(255,255,255,0.08);
    border:1px solid rgba(255,255,255,0.12);
    border-radius:12px;
    padding:10px;
    cursor:pointer;
    text-align:left;
    font-weight:600;
    font-size:14px;
  }
  .menu-btn span{
    display:block;
    margin-top:6px;
    font-size:12px;
    color:var(--muted);
    font-weight:500;
  }
  .menu-btn:hover{background:rgba(255,255,255,0.12);}
  .cart-item{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:8px;
    border-bottom:1px solid rgba(255,255,255,0.12);
    padding-bottom:8px;
  }
  .cart-left{
    display:flex;
    flex-direction:column;
  }
  .cart-name{font-weight:700;}
  .cart-qty{
    display:flex;
    gap:6px;
    margin-top:4px;
  }
  .qty-btn{
    padding:4px 8px;
    border-radius:8px;
    border:1px solid var(--border);
    background:rgba(255,255,255,0.08);
    cursor:pointer;
  }
  .qty-btn:hover{background:rgba(255,255,255,0.12);}
  .cart-right{
    text-align:right;
  }
  .total{
    display:flex;
    justify-content:space-between;
    font-weight:800;
    padding-top:8px;
    border-top:1px solid rgba(255,255,255,0.12);
    margin-top:10px;
  }
  .payment-row{
    display:flex;
    gap:8px;
    margin-top:10px;
  }
  .pay-btn{
    flex:1;
    padding:10px;
    border-radius:12px;
    border:1px solid var(--border);
    background:rgba(255,255,255,0.08);
    cursor:pointer;
    font-weight:700;
  }
  .pay-btn.active{
    background:var(--accent);
    border-color:rgba(124,58,237,0.8);
  }
  .input-group{
    display:flex;
    gap:8px;
    margin-top:10px;
  }
  input[type="number"]{
    flex:1;
    padding:10px;
    border-radius:12px;
    border:1px solid var(--border);
    background:rgba(255,255,255,0.06);
    color:var(--text);
    font-weight:700;
    font-size:16px;
  }
  .small-btn{
    padding:10px;
    border-radius:12px;
    border:1px solid var(--border);
    background:rgba(255,255,255,0.08);
    cursor:pointer;
    font-weight:700;
  }
  .small-btn:hover{background:rgba(255,255,255,0.12);}
  .footer-fixed{
    position:fixed;
    bottom:0;
    left:0;
    right:0;
    padding:10px;
    background:rgba(11,18,32,0.95);
    border-top:1px solid rgba(255,255,255,0.12);
  }
  .footer-inner{
    max-width:420px;
    margin:0 auto;
    display:flex;
    gap:8px;
  }
  .btn-wide{
    flex:1;
    padding:12px;
    border-radius:12px;
    border:1px solid var(--border);
    background:var(--accent);
    color:#fff;
    font-weight:800;
    cursor:pointer;
  }
  .btn-danger{
    background:var(--danger);
  }
  .history-list{
    max-height: 430px;
    overflow:auto;
    margin-top:10px;
  }
  .hist-item{
    border:1px solid rgba(255,255,255,0.12);
    border-radius:12px;
    padding:10px;
    margin-bottom:10px;
  }
  .hist-top{
    display:flex;
    justify-content:space-between;
    font-weight:800;
  }
  .hist-detail{
    margin-top:8px;
    font-size:13px;
    color:var(--muted);
  }
  .muted{color:var(--muted);}
  .hide{display:none;}
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <div class="tabs">
      <div class="tab active" id="tabTrans" onclick="showTab('transaksi')">Transaksi</div>
      <div class="tab" id="tabHist" onclick="showTab('history')">History</div>
    </div>
    <div class="muted">Nasi Kuning 51</div>
  </div>

  <!-- TRANSAKSI -->
  <div id="pageTransaksi">
    <div class="section card">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div style="font-weight:800;">Menu</div>
        <div style="font-size:12px;color:var(--muted);">Tap untuk tambah</div>
      </div>

      <!-- Tabs menu utama/additional -->
      <div style="display:flex;gap:8px;margin-top:10px;">
        <button class="pay-btn active" id="tabMenuUtama" onclick="setMenuTab('utama')">Utama</button>
        <button class="pay-btn" id="tabMenuAdd" onclick="setMenuTab('additional')">Additional</button>
      </div>

      <div class="grid" id="menuGrid"></div>
    </div>

    <div class="section card" style="margin-top:10px;">
      <div style="font-weight:800;">Pesanan</div>
      <div id="cartList" style="margin-top:10px;"></div>

      <div class="total">
        <div>Total</div>
        <div id="totalHarga">0</div>
      </div>
      <div class="total">
        <div>Item</div>
        <div id="totalItem">0</div>
      </div>
    </div>

    <div class="section card" style="margin-top:10px;">
      <div style="font-weight:800;">Pembayaran</div>

      <div class="payment-row">
        <button class="pay-btn" id="btnCash" onclick="setPayment('cash')">Cash</button>
        <button class="pay-btn" id="btnQris" onclick="setPayment('qris')">QRIS</button>
      </div>

      <div class="input-group">
        <input type="number" id="uangBayar" placeholder="Uang Bayar" oninput="calculateChange()" />
        <button class="small-btn" onclick="setQuick(5000)">5K</button>
        <button class="small-btn" onclick="setQuick(10000)">10K</button>
        <button class="small-btn" onclick="setQuick(20000)">20K</button>
        <button class="small-btn" onclick="setQuick(50000)">50K</button>
        <button class="small-btn" onclick="setQuick(100000)">100K</button>
      </div>

      <div style="display:flex;gap:8px;margin-top:10px;">
        <button class="small-btn" onclick="setExact()">Uang Pas</button>
        <button class="small-btn" onclick="clearUangBayar()">Clear</button>
      </div>

      <div class="total" style="margin-top:10px;">
        <div>Kembalian</div>
        <div id="kembalian">0</div>
      </div>
    </div>
  </div>

  <!-- HISTORY -->
  <div id="pageHistory" class="hide">
    <div class="section card">
      <div style="font-weight:800;">History Penjualan</div>
      <div class="history-list" id="historyList"></div>

      <div style="display:flex;gap:8px;margin-top:10px;">
        <button class="btn-wide" onclick="saveHistory()">Simpan History</button>
        <button class="btn-wide btn-danger" onclick="resetHistory()">Reset History</button>
      </div>
      <div style="display:flex;gap:8px;margin-top:10px;">
        <button class="btn-wide" onclick="closeCashier()">Tutup Kasir</button>
      </div>
    </div>
  </div>
</div>

<div class="footer-fixed">
  <div class="footer-inner">
    <button class="btn-wide btn-danger" onclick="resetCart()">Reset Transaksi</button>
    <button class="btn-wide" onclick="completeTransaction()">Selesaikan Transaksi</button>
  </div>
</div>

<script>
  const menus = [
    {name:"Nasi kuning ayam", price:15000, type:"utama"},
    {name:"Nasi kuning ikan", price:13000, type:"utama"},
    {name:"Nasi kuning telur", price:10000, type:"utama"},
    {name:"Nasi kuning ayam telur", price:23000, type:"utama"},
    {name:"Nasi kuning ika telur", price:20000, type:"utama"},
    {name:"Ikan", price:5000, type:"additional"},
    {name:"Bakwan", price:2000, type:"additional"},
    {name:"Nasi", price:5000, type:"additional"},
    {name:"Telur", price:5000, type:"additional"},
    {name:"Ayam", price:5000, type:"additional"},
    {name:"Air mineral", price:5000, type:"additional"},
  ];

  let cart = [];
  let history = [];
  let paymentMethod = "";
  let currentMenuTab = "utama";

  function saveToStorage(){
    localStorage.setItem("bucek_cart", JSON.stringify(cart));
    localStorage.setItem("bucek_history", JSON.stringify(history));
    localStorage.setItem("bucek_payment", paymentMethod);
    localStorage.setItem("bucek_menuTab", currentMenuTab);
  }

  function loadFromStorage(){
    cart = JSON.parse(localStorage.getItem("bucek_cart")) || [];
    history = JSON.parse(localStorage.getItem("bucek_history")) || [];
    paymentMethod = localStorage.getItem("bucek_payment") || "";
    currentMenuTab = localStorage.getItem("bucek_menuTab") || "utama";
  }

  function showTab(tab){
    document.getElementById("pageTransaksi").classList.add("hide");
    document.getElementById("pageHistory").classList.add("hide");
    document.getElementById("tabTrans").classList.remove("active");
    document.getElementById("tabHist").classList.remove("active");

    if(tab === "transaksi"){
      document.getElementById("pageTransaksi").classList.remove("hide");
      document.getElementById("tabTrans").classList.add("active");
    } else {
      document.getElementById("pageHistory").classList.remove("hide");
      document.getElementById("tabHist").classList.add("active");
      renderHistory();
    }
  }

  function setMenuTab(tab){
    currentMenuTab = tab;
    document.getElementById("tabMenuUtama").classList.remove("active");
    document.getElementById("tabMenuAdd").classList.remove("active");
    if(tab === "utama") document.getElementById("tabMenuUtama").classList.add("active");
    else document.getElementById("tabMenuAdd").classList.add("active");
    renderMenu();
    saveToStorage();
  }

  function renderMenu(){
    const grid = document.getElementById("menuGrid");
    grid.innerHTML = "";
    const filtered = menus.filter(m => m.type === currentMenuTab);
    filtered.forEach(m => {
      const btn = document.createElement("button");
      btn.className = "menu-btn";
      btn.innerHTML = `${m.name}<span>Rp ${m.price.toLocaleString()}</span>`;
      btn.onclick = () => addToCart(m.name, m.price);
      grid.appendChild(btn);
    });
  }

  function addToCart(name, price){
    const existing = cart.find(i => i.name === name);
    if(existing){
      existing.qty += 1;
    } else {
      cart.push({name, price, qty:1});
    }
    calculateTotal();
    renderCart();
    saveToStorage();
  }

  function renderCart(){
    const cartList = document.getElementById("cartList");
    cartList.innerHTML = "";
    cart.forEach((item, idx) => {
      const div = document.createElement("div");
      div.className = "cart-item";
      div.innerHTML = `
        <div class="cart-left">
          <div class="cart-name">${item.name}</div>
          <div class="cart-qty">
            <button class="qty-btn" onclick="changeQty(${idx}, -1)">-</button>
            <div>${item.qty}</div>
            <button class="qty-btn" onclick="changeQty(${idx}, 1)">+</button>
            <button class="qty-btn" onclick="removeItem(${idx})">Hapus</button>
          </div>
        </div>
        <div class="cart-right">
          <div>Rp ${ (item.price * item.qty).toLocaleString() }</div>
        </div>
      `;
      cartList.appendChild(div);
    });
  }

  function changeQty(idx, delta){
    cart[idx].qty += delta;
    if(cart[idx].qty <= 0){
      cart.splice(idx,1);
    }
    calculateTotal();
    renderCart();
    saveToStorage();
  }

  function removeItem(idx){
    cart.splice(idx,1);
    calculateTotal();
    renderCart();
    saveToStorage();
  }

  function calculateTotal(){
    let total = 0;
    let itemCount = 0;
    cart.forEach(i => {
      total += i.price * i.qty;
      itemCount += i.qty;
    });
    document.getElementById("totalHarga").innerText = total.toLocaleString();
    document.getElementById("totalItem").innerText = itemCount;
    calculateChange();
  }

  function setPayment(method){
    paymentMethod = method;
    document.getElementById("btnCash").classList.remove("active");
    document.getElementById("btnQris").classList.remove("active");
    if(method === "cash") document.getElementById("btnCash").classList.add("active");
    if(method === "qris"){
      document.getElementById("btnQris").classList.add("active");
      document.getElementById("uangBayar").value = document.getElementById("totalHarga").innerText.replace(/,/g,'');
    }
    saveToStorage();
    calculateChange();
  }

  function setQuick(amount){
    const current = Number(document.getElementById("uangBayar").value || 0);
    document.getElementById("uangBayar").value = current + amount;
    calculateChange();
  }

  function setExact(){
    document.getElementById("uangBayar").value = document.getElementById("totalHarga").innerText.replace(/,/g,'');
    calculateChange();
  }

  function clearUangBayar(){
    document.getElementById("uangBayar").value = "";
    calculateChange();
  }

  function calculateChange(){
    const total = Number(document.getElementById("totalHarga").innerText.replace(/,/g,'') || 0);
    const bayar = Number(document.getElementById("uangBayar").value || 0);
    const change = bayar - total;
    document.getElementById("kembalian").innerText = change >= 0 ? change.toLocaleString() : "0";
  }

  function resetCart(){
    if(confirm("Reset transaksi saat ini?")) {
      cart = [];
      calculateTotal();
      renderCart();
      clearUangBayar();
      paymentMethod = "";
      document.getElementById("btnCash").classList.remove("active");
      document.getElementById("btnQris").classList.remove("active");
      saveToStorage();
    }
  }

  function completeTransaction(){
    const total = Number(document.getElementById("totalHarga").innerText.replace(/,/g,'') || 0);
    const bayar = Number(document.getElementById("uangBayar").value || 0);

    if(cart.length === 0){
      alert("Tidak ada pesanan.");
      return;
    }
    if(!paymentMethod){
      alert("Pilih metode pembayaran.");
      return;
    }
    if(bayar < total){
      alert("Uang tidak cukup.");
      return;
    }

    const change = bayar - total;
    const now = new Date();
    const record = {
      time: now.toLocaleString(),
      items: cart,
      total,
      bayar,
      change,
      paymentMethod
    };
    history.push(record);
    saveToStorage();

    // reset cart
    cart = [];
    calculateTotal();
    renderCart();
    clearUangBayar();
    paymentMethod = "";
    document.getElementById("btnCash").classList.remove("active");
    document.getElementById("btnQris").classList.remove("active");
    alert("Transaksi berhasil disimpan.");
  }

  function renderHistory(){
    const list = document.getElementById("historyList");
    list.innerHTML = "";
    history.slice().reverse().forEach(h => {
      const div = document.createElement("div");
      div.className = "hist-item";
      let itemsText = h.items.map(i => `${i.name} x${i.qty}`).join(", ");
      div.innerHTML = `
        <div class="hist-top">
          <div>${h.time}</div>
          <div>${h.paymentMethod.toUpperCase()}</div>
        </div>
        <div class="hist-detail">
          ${itemsText}<br>
          Total: Rp ${h.total.toLocaleString()} • Bayar: Rp ${h.bayar.toLocaleString()} • Kembali: Rp ${h.change.toLocaleString()}
        </div>
      `;
      list.appendChild(div);
    });
  }

  function saveHistory(){
    if(history.length === 0){
      alert("History kosong.");
      return;
    }
    const now = new Date();
    const filename = `bucek_history_${now.getFullYear()}${(now.getMonth()+1).toString().padStart(2,'0')}${now.getDate().toString().padStart(2,'0')}_${now.getHours().toString().padStart(2,'0')}${now.getMinutes().toString().padStart(2,'0')}.txt`;
    let text = "HISTORY PENJUALAN\n\n";
    history.forEach(h => {
      text += `Waktu: ${h.time}\n`;
      text += `Metode: ${h.paymentMethod}\n`;
      text += `Items:\n`;
      h.items.forEach(i => {
        text += `- ${i.name} x${i.qty} (Rp ${i.price.toLocaleString()} each)\n`;
      });
      text += `Total: Rp ${h.total.toLocaleString()}\n`;
      text += `Bayar: Rp ${h.bayar.toLocaleString()}\n`;
      text += `Kembali: Rp ${h.change.toLocaleString()}\n`;
      text += `---------------------------------\n`;
    });

    const blob = new Blob([text], {type:"text/plain"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    a.click();
    URL.revokeObjectURL(a.href);
  }

  function resetHistory(){
    if(confirm("Reset history penjualan?")) {
      history = [];
      saveToStorage();
      renderHistory();
    }
  }

  function closeCashier(){
    if(history.length === 0){
      alert("Tidak ada transaksi untuk disimpan.");
      return;
    }
    const now = new Date();
    const filename = `bucek_tutupkasir_${now.getFullYear()}${(now.getMonth()+1).toString().padStart(2,'0')}${now.getDate().toString().padStart(2,'0')}_${now.getHours().toString().padStart(2,'0')}${now.getMinutes().toString().padStart(2,'0')}.txt`;

    let text = "REKAP TUTUP KASIR\n\n";
    let totalOmzet = 0;
    history.forEach(h => {
      totalOmzet += h.total;
      text += `Waktu: ${h.time}\n`;
      text += `Metode: ${h.paymentMethod}\n`;
      h.items.forEach(i => {
        text += `- ${i.name} x${i.qty} (Rp ${i.price.toLocaleString()} each)\n`;
      });
      text += `Total: Rp ${h.total.toLocaleString()}\n`;
      text += `Bayar: Rp ${h.bayar.toLocaleString()}\n`;
      text += `Kembali: Rp ${h.change.toLocaleString()}\n`;
      text += `---------------------------------\n`;
    });
    text += `\nTOTAL OMZET: Rp ${totalOmzet.toLocaleString()}\n`;

    const blob = new Blob([text], {type:"text/plain"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    a.click();
    URL.revokeObjectURL(a.href);

    // reset history
    history = [];
    saveToStorage();
    renderHistory();
    showTab('transaksi');
    alert("Tutup kasir selesai. History telah disimpan dan direset.");
  }

  // init
  loadFromStorage();
  setMenuTab(currentMenuTab);
  renderCart();
  calculateTotal();
  showTab('transaksi');
</script>
</body>
</html>
