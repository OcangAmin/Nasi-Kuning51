<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Kasir Nasi Kuning 51</title>

<style>
*{box-sizing:border-box;font-family:Arial}
body{margin:0;height:100vh;overflow:hidden;background:#f2f2f2}

/* HEADER */
header{
  background:#ff9800;
  color:white;
  text-align:center;
  padding:10px;
  font-weight:bold;
}

/* MAIN */
.main{
  height:calc(100vh - 140px);
  overflow-y:auto;
  padding:10px;
}

/* BUTTON FEEL */
button{
  transition:.15s;
  -webkit-tap-highlight-color:transparent;
}
button:active{transform:scale(.96)}

/* MENU */
.menu{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:8px;
}
.menu button{
  padding:12px;
  background:linear-gradient(145deg,#ffffff,#e6e6e6);
  border:none;
  border-radius:10px;
  font-weight:bold;
  box-shadow:0 1px 4px rgba(0,0,0,.25);
  font-size:14px;
}

/* CART */
.cart{
  background:#fff;
  margin-top:10px;
  padding:8px;
  border-radius:10px;
}
.cart-item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:14px;
  margin-bottom:4px;
}
.cart-item button{
  background:#f44336;
  color:white;
  border:none;
  border-radius:5px;
  padding:2px 6px;
}

/* PAYMENT */
.payment{
  background:#fff;
  margin-top:10px;
  padding:8px;
  border-radius:10px;
}
.payment button{
  padding:10px;
  margin:4px;
  border:none;
  border-radius:8px;
  font-weight:bold;
  min-width:90px;
}
.active{
  background:linear-gradient(145deg,#4caf50,#2e7d32)!important;
  color:white;
}

/* NOMINAL */
.nominal button{
  background:linear-gradient(145deg,#eeeeee,#d6d6d6);
  font-weight:bold;
}

/* HISTORY */
.history{
  background:#fff;
  margin-top:10px;
  padding:8px;
  border-radius:10px;
  font-size:12px;
}

/* FOOTER */
.footer{
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  background:#fff;
  padding:8px;
  box-shadow:0 -2px 6px rgba(0,0,0,.2);
}
.footer button{
  width:100%;
  padding:14px;
  font-size:16px;
  background:linear-gradient(145deg,#4caf50,#2e7d32);
  color:white;
  border:none;
  border-radius:10px;
  font-weight:bold;
  letter-spacing:.5px;
}
</style>
</head>

<body>

<header>KASIR â€“ NASI KUNING 51</header>

<div class="main">

<!-- MENU -->
<div class="menu" id="menu"></div>

<!-- CART -->
<div class="cart" id="cart"></div>

<!-- PAYMENT -->
<div class="payment">
<b>Metode Pembayaran</b><br>
<button id="cashBtn" onclick="setPay('CASH')">CASH</button>
<button id="qrisBtn" onclick="setPay('QRIS')">QRIS</button>

<br><br>
<div style="display:flex;gap:6px">
  <input id="paid" type="number" placeholder="Uang Bayar"
    inputmode="numeric"
    style="flex:1;padding:10px;font-size:16px"
    oninput="calc()">
  <button onclick="clearPay()"
    style="background:linear-gradient(145deg,#f44336,#d32f2f);
           color:white;font-weight:bold;border:none;border-radius:8px">
    CLEAR
  </button>
</div>

<div class="nominal">
<button onclick="addPay(5000)">5K</button>
<button onclick="addPay(10000)">10K</button>
<button onclick="addPay(20000)">20K</button>
<button onclick="addPay(50000)">50K</button>
<button onclick="addPay(100000)">100K</button>
<button onclick="pas()">UANG PAS</button>
</div>

<b>Total:</b> <span id="total">0</span><br>
<b>Kembalian:</b> <span id="change">0</span>
</div>

<!-- HISTORY -->
<div class="history">
<b>Histori Transaksi</b>
<div id="history"></div>
<button onclick="saveHistory()">ðŸ’¾ Simpan Histori</button>
<button onclick="tutupKasir()">ðŸ”’ Tutup Kasir</button>
</div>

</div>

<div class="footer">
<button onclick="finish()">SELESAIKAN TRANSAKSI</button>
</div>

<script>
const menus=[
{name:'Ikan',price:5000},
{name:'Bakwan',price:2000},
{name:'Nasi',price:5000},
{name:'Telur',price:5000},
{name:'Ayam',price:5000},
{name:'Nasi kuning ayam',price:15000},
{name:'Nasi kuning ikan',price:13000},
{name:'Nasi kuning telur',price:10000},
{name:'Nasi kuning ayam telur',price:23000},
{name:'Nasi kuning ikan telur',price:20000},
{name:'Air mineral',price:5000},
];

let cart=JSON.parse(localStorage.getItem('cart'))||{};
let history=JSON.parse(localStorage.getItem('history'))||[];
let payMethod=localStorage.getItem('payMethod')||'';

const menuDiv=document.getElementById('menu');
menus.forEach(m=>{
  const b=document.createElement('button');
  b.innerText=`${m.name}\nRp${m.price}`;
  b.onclick=()=>addItem(m);
  menuDiv.appendChild(b);
});

function addItem(m){
  cart[m.name]=(cart[m.name]||0)+1;
  save(); render();
}
function removeItem(n){
  delete cart[n]; save(); render();
}
function total(){
  return Object.keys(cart).reduce((t,k)=>{
    const m=menus.find(x=>x.name===k);
    return t+(m.price*cart[k]);
  },0);
}
function render(){
  const c=document.getElementById('cart');
  c.innerHTML='<b>Pesanan</b><br>';
  for(let k in cart){
    const m=menus.find(x=>x.name===k);
    c.innerHTML+=`
    <div class="cart-item">
    ${k} x${cart[k]} = ${m.price*cart[k]}
    <button onclick="removeItem('${k}')">X</button>
    </div>`;
  }
  document.getElementById('total').innerText=total();
  calc();
}
function setPay(p){
  payMethod=p;
  localStorage.setItem('payMethod', p);

  cashBtn.classList.remove('active');
  qrisBtn.classList.remove('active');

  if(p==='CASH'){cashBtn.classList.add('active')}
  if(p==='QRIS'){
    qrisBtn.classList.add('active');
    paid.value=total();
  }
  calc();
}
function addPay(v){
  paid.value=(+paid.value||0)+v;
  calc();
}
function pas(){paid.value=total();calc()}
function clearPay(){paid.value='';calc()}
function calc(){
  const ch=(+paid.value||0)-total();
  document.getElementById('change').innerText=ch>0?ch:0;
}
function finish(){
  if(Object.keys(cart).length===0) return alert('Belum ada pesanan');
  if(!payMethod) return alert('Pilih metode pembayaran');
  if(+paid.value<total()) return alert('Uang tidak cukup');

  history.push({
    time:new Date().toLocaleString(),
    items:{...cart},
    total:total(),
    bayar:+paid.value,
    kembalian:(+paid.value-total()),
    metode:payMethod
  });

  cart={}; paid.value=''; payMethod='';
  localStorage.removeItem('payMethod');

  save(); render(); renderHistory();
}
function renderHistory(){
  const h=document.getElementById('history');
  h.innerHTML='';
  history.forEach((x,i)=>{
    let detail='';
    for(let k in x.items){
      detail += `${k} x${x.items[k]} | `;
    }
    h.innerHTML+=`
    <div style="margin-bottom:6px;">
      <b>#${i+1}</b> ${x.time} <br>
      <span>${detail}</span><br>
      <span>Total: ${x.total} | Bayar: ${x.bayar} | Kembali: ${x.kembalian} | Metode: ${x.metode}</span>
    </div>
    <hr>
    `;
  });
}
function save(){
  localStorage.setItem('cart',JSON.stringify(cart));
  localStorage.setItem('history',JSON.stringify(history));
}
function saveHistory(){
  let text='HISTORI TRANSAKSI\n';
  history.forEach(h=>{
    text+=`${h.time}\n`;
    for(let i in h.items){text+=`- ${i} x${h.items[i]}\n`}
    text+=`Total:${h.total} Bayar:${h.bayar} Kembalian:${h.kembalian} (${h.metode})\n\n`;
  });
  const blob=new Blob([text],{type:'text/plain'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download=`bucek-histori-kasir-${new Date().toISOString().slice(0,10)}.txt`;
  a.click();
}
function tutupKasir(){
  if(history.length===0) return alert('Belum ada transaksi');

  let omzet=0,cash=0,qris=0;
  history.forEach(h=>{
    omzet+=h.total;
    if(h.metode==='CASH') cash+=h.total;
    if(h.metode==='QRIS') qris+=h.total;
  });

  let text='LAPORAN TUTUP KASIR\nKasir: NASI KUNING 51\n';
  text+='Waktu: '+new Date().toLocaleString()+'\n\n';
  history.forEach((h,i)=>{
    text+=`#${i+1} ${h.time}\n`;
    for(let k in h.items){text+=`- ${k} x${h.items[k]}\n`}
    text+=`Total:${h.total} Bayar:${h.bayar} Kembalian:${h.kembalian} (${h.metode})\n\n`;
  });
  text+=`TOTAL TRANSAKSI:${history.length}\nOMZET:${omzet}\nCASH:${cash}\nQRIS:${qris}`;

  const blob=new Blob([text],{type:'text/plain'});
  const a=document.createElement('a');
  const now=new Date();
  a.href=URL.createObjectURL(blob);
  a.download=`bucek-tutup-kasir-${now.toISOString().replace(/[:.]/g,'-')}.txt`;
  a.click();

  history=[]; cart={};
  localStorage.removeItem('history');
  localStorage.removeItem('cart');
  localStorage.removeItem('payMethod');

  render(); renderHistory();
  alert('Kasir ditutup & data di-reset');
}

render(); renderHistory();
</script>

</body>
</html>
