<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kasir Nasi Kuning 51</title>

<style>
body{
  font-family:Arial, sans-serif;
  background:#f4f6f8;
  margin:0;
  padding:10px;
}
h2{text-align:center;margin:5px 0;}
.section{
  background:#fff;
  padding:10px;
  border-radius:8px;
  margin-bottom:10px;
}
.menu-grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:6px;
}
.menu-grid button{
  padding:12px;
  border:none;
  border-radius:6px;
  background:#e3f2fd;
  font-size:14px;
}
.menu-grid button:active{background:#bbdefb;}

.table{
  width:100%;
  border-collapse:collapse;
  font-size:13px;
}
.table th,.table td{
  border-bottom:1px solid #ddd;
  padding:6px;
}
.right{text-align:right;}

.btn{
  width:100%;
  padding:12px;
  border:none;
  border-radius:6px;
  margin-top:6px;
  font-size:14px;
}
.btn-green{background:#4caf50;color:#fff;}
.btn-blue{background:#2196f3;color:#fff;}
.btn-red{background:#f44336;color:#fff;}

.pay-grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:6px;
}
.nominal-grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:6px;
}

.pay-btn{
  background:#e0e0e0;
  transition:0.15s;
}
.pay-btn.active{
  background:#4caf50;
  color:#fff;
  font-weight:bold;
}
.pay-btn:active{
  transform:scale(0.97);
}

input{
  width:100%;
  padding:10px;
  font-size:14px;
}
.warning{
  color:red;
  font-size:13px;
  margin-top:5px;
}
.small{font-size:12px;color:#555;}
</style>
</head>

<body>

<h2>Kasir Nasi Kuning 51</h2>

<div class="section">
<h3>Menu</h3>
<div class="menu-grid" id="menu"></div>
</div>

<div class="section">
<h3>Pesanan</h3>
<table class="table">
<thead>
<tr><th>Item</th><th>Qty</th><th class="right">Subtotal</th><th></th></tr>
</thead>
<tbody id="cart"></tbody>
</table>
<b>Total: Rp <span id="total">0</span></b>
</div>

<div class="section">
<h3>Metode Pembayaran</h3>

<div class="pay-grid">
<button id="btnCash" class="btn pay-btn" onclick="setPayment('CASH')">üíµ CASH</button>
<button id="btnQris" class="btn pay-btn" onclick="setPayment('QRIS')">üì± QRIS</button>
</div>

<p class="small">Metode dipilih: <b><span id="payInfo">-</span></b></p>

<input type="number" id="paid" placeholder="Uang bayar" oninput="calcChange()">

<div class="nominal-grid">
<button onclick="quickPay(5000)">5.000</button>
<button onclick="quickPay(10000)">10.000</button>
<button onclick="quickPay(20000)">20.000</button>
<button onclick="quickPay(50000)">50.000</button>
<button onclick="quickPay(100000)">100.000</button>
<button onclick="exactPay()">Uang Pas</button>
</div>

<p>Kembalian: Rp <span id="change">0</span></p>
<p class="warning" id="warn"></p>

<button class="btn btn-green" onclick="finish()">Selesaikan Transaksi</button>
</div>

<div class="section">
<h3>Histori Pembayaran</h3>
<table class="table">
<thead>
<tr><th>Waktu</th><th>Total</th><th>Bayar</th><th>Kembali</th><th>Metode</th></tr>
</thead>
<tbody id="history"></tbody>
</table>

<button class="btn btn-blue" onclick="saveFile()">Save History</button>
<button class="btn btn-red" onclick="closeCashier()">Tutup Kasir</button>
</div>

<script>
const menuData=[
["Ikan",5000],["Bakwan",2000],["Nasi",5000],["Telur",5000],
["Ayam",5000],["Nasi kuning ayam",15000],["Nasi kuning ikan",13000],
["Nasi kuning telur",10000],["Nasi kuning ayam telur",23000],
["Nasi kuning ikan telur",20000],["Air mineral",5000]
];

let cart={},payment="";
let history=JSON.parse(localStorage.getItem("history")||"[]");

function rupiah(n){return n.toLocaleString("id-ID");}

menuData.forEach(m=>{
  let b=document.createElement("button");
  b.innerHTML=`${m[0]}<br>Rp ${rupiah(m[1])}`;
  b.onclick=()=>addItem(m[0],m[1]);
  menu.appendChild(b);
});

function addItem(n,p){
  cart[n]?cart[n].qty++:cart[n]={price:p,qty:1};
  renderCart();
}

function renderCart(){
  cart.innerHTML="";
  let t=0;
  for(let k in cart){
    let s=cart[k].price*cart[k].qty;
    t+=s;
    cart.innerHTML+=`
<tr>
<td>${k}</td>
<td>${cart[k].qty}</td>
<td class="right">${rupiah(s)}</td>
<td><button onclick="del('${k}')">‚ùå</button></td>
</tr>`;
  }
  total.innerText=rupiah(t);
  calcChange();
}

function del(k){delete cart[k];renderCart();}

function setPayment(p){
  payment=p;
  btnCash.classList.remove("active");
  btnQris.classList.remove("active");
  if(p==="CASH")btnCash.classList.add("active");
  if(p==="QRIS")btnQris.classList.add("active");
  payInfo.innerText=p;
  paid.focus();
}

function quickPay(n){
  paid.value=(+paid.value||0)+n;
  calcChange();
}

function exactPay(){
  paid.value=getTotal();
  calcChange();
}

function getTotal(){
  let t=0;for(let k in cart)t+=cart[k].price*cart[k].qty;
  return t;
}

function calcChange(){
  let total=getTotal();
  let bayar=+paid.value||0;
  let kembali=bayar-total;
  change.innerText=kembali>0?rupiah(kembali):0;
}

function finish(){
  warn.innerText="";
  if(!payment)return warn.innerText="Pilih metode pembayaran";
  if(paid.value<getTotal())return warn.innerText="Uang bayar tidak mencukupi";
  if(getTotal()==0)return;

  history.push({
    time:new Date().toLocaleString("id-ID"),
    total:getTotal(),
    paid:+paid.value,
    change:paid.value-getTotal(),
    pay:payment
  });

  localStorage.setItem("history",JSON.stringify(history));
  cart={};paid.value="";payment="";
  btnCash.classList.remove("active");
  btnQris.classList.remove("active");
  payInfo.innerText="-";
  renderCart();renderHistory();
}

function renderHistory(){
  history.innerHTML="";
  history.forEach(h=>{
    history.innerHTML+=`
<tr>
<td>${h.time}</td>
<td>${rupiah(h.total)}</td>
<td>${rupiah(h.paid)}</td>
<td>${rupiah(h.change)}</td>
<td>${h.pay}</td>
</tr>`;
  });
}
renderHistory();

function saveFile(){
  let txt="LAPORAN NASI KUNING 51\n\n";
  let omzet=0;
  history.forEach(h=>{
    txt+=`${h.time} | Total:${h.total} | Bayar:${h.paid} | Kembali:${h.change} | ${h.pay}\n`;
    omzet+=h.total;
  });
  txt+=`\nTOTAL TRANSAKSI: ${history.length}\nTOTAL OMZET: ${omzet}`;
  download(txt);
}

function closeCashier(){
  saveFile();
  alert("Kasir ditutup & laporan tersimpan");
}

function download(txt){
  let d=new Date().toLocaleDateString("id-ID").replace(/\//g,"-");
  let a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([txt],{type:"text/plain"}));
  a.download=`kasir_nasi_kuning_51_${d}.txt`;
  a.click();
}
</script>

</body>
</html>
