<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Kasir Nasi Kuning 51</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box}
body{
    margin:0;
    font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
    background:#eef1f4;
    padding:10px;
}
.app{
    max-width:420px;
    margin:auto;
    background:#fff;
    border-radius:16px;
    padding:14px;
    box-shadow:0 8px 20px rgba(0,0,0,.08);
}
.header{
    text-align:center;
    margin-bottom:12px;
}
.header h1{
    margin:0;
    font-size:22px;
}
.header small{color:#666}

.card{
    background:#fafafa;
    border-radius:12px;
    padding:10px;
    margin-bottom:10px;
}

.row{
    display:flex;
    gap:6px;
    margin-bottom:6px;
}

select,input,button{
    padding:10px;
    border-radius:10px;
    border:1px solid #ddd;
    font-size:14px;
}
select,input{flex:1}

button{
    border:none;
    font-weight:600;
    cursor:pointer;
}

.add{background:#0d6efd;color:#fff;width:100%}
.cash{background:#198754;color:#fff;flex:1}
.qris{background:#6f42c1;color:#fff;flex:1}
.save{background:#fd7e14;color:#fff;width:100%}

table{
    width:100%;
    border-collapse:collapse;
    font-size:13px;
}
th,td{
    padding:6px;
    border-bottom:1px solid #eee;
    text-align:center;
}
th{color:#777}

.delete{
    background:#dc3545;
    color:#fff;
    border-radius:6px;
    padding:4px 6px;
    font-size:12px;
}

.totalBox{
    display:flex;
    justify-content:space-between;
    font-size:18px;
    font-weight:700;
    margin-top:6px;
}
.kembali{
    display:flex;
    justify-content:space-between;
    font-weight:600;
    margin-top:4px;
    color:#198754;
}
.metode{
    text-align:center;
    font-weight:600;
    margin-top:4px;
}
</style>
</head>

<body>
<div class="app">

<div class="header">
    <h1>üçö Nasi Kuning 51</h1>
    <small>Kasir Manual</small>
</div>

<!-- INPUT -->
<div class="card">
<div class="row">
<select id="menu">
<option value="" disabled selected>Pilih Menu</option>
<option value="Ikan|5000">Ikan - 5.000</option>
<option value="Bakwan|2000">Bakwan - 2.000</option>
<option value="Nasi|5000">Nasi - 5.000</option>
<option value="Telur|5000">Telur - 5.000</option>
<option value="Ayam|5000">Ayam - 5.000</option>
<option value="Nasi Kuning Ayam|15000">NK Ayam - 15.000</option>
<option value="Nasi Kuning Ikan|13000">NK Ikan - 13.000</option>
<option value="Nasi Kuning Telur|10000">NK Telur - 10.000</option>
<option value="Nasi Kuning Ayam Telur|23000">NK Ayam Telur - 23.000</option>
<option value="Nasi Kuning Ikan Telur|20000">NK Ikan Telur - 20.000</option>
<option value="Air Mineral|5000">Air Mineral - 5.000</option>
</select>
<input type="number" id="qty" min="1" value="1">
</div>
<button class="add" onclick="tambah()">‚ûï Tambah Item</button>
</div>

<!-- CART -->
<div class="card">
<table>
<thead>
<tr>
<th>Menu</th>
<th>Qty</th>
<th>Sub</th>
<th></th>
</tr>
</thead>
<tbody id="cart"></tbody>
</table>

<div class="totalBox">
<span>Total</span>
<span>Rp <span id="total">0</span></span>
</div>
</div>

<!-- PEMBAYARAN -->
<div class="card">
<div class="row">
<button class="cash" onclick="setMetode('CASH')">üíµ CASH</button>
<button class="qris" onclick="setMetode('QRIS')">üì± QRIS</button>
</div>

<input type="number" id="bayar" placeholder="Uang Bayar" oninput="hitungKembali()">

<div class="kembali">
<span>Kembalian</span>
<span>Rp <span id="kembali">0</span></span>
</div>

<div class="metode">Metode: <span id="metode">-</span></div>

<button class="save" onclick="simpan()">üíæ Save Transaksi</button>
</div>

<!-- HISTORI -->
<div class="card">
<b>üìú Histori</b>
<table>
<thead>
<tr>
<th>Tgl</th>
<th>Jam</th>
<th>Metode</th>
<th>Total</th>
</tr>
</thead>
<tbody id="histori"></tbody>
</table>
</div>

</div>

<script>
let total=0, metode="";

function tambah(){
    if(!menu.value) return;
    const [nama,harga]=menu.value.split("|");
    const q=+qty.value;
    const sub=harga*q;

    cart.innerHTML+=`
    <tr>
        <td>${nama}</td>
        <td>${q}</td>
        <td>${sub}</td>
        <td><button class="delete" onclick="hapus(this,${sub})">‚úï</button></td>
    </tr>`;
    total+=sub;
    update();
}

function hapus(btn,sub){
    btn.parentElement.parentElement.remove();
    total-=sub;
    update();
}

function update(){
    totalSpan.innerText=total;
    hitungKembali();
}

function setMetode(m){
    metode=m;
    metodeSpan.innerText=m;
    if(m==="QRIS"){
        bayar.value=total;
        bayar.disabled=true;
    }else{
        bayar.disabled=false;
        bayar.value="";
    }
    hitungKembali();
}

function hitungKembali(){
    const b=+bayar.value||0;
    kembali.innerText = b-total>0 ? b-total : 0;
}

function simpan(){
    if(total===0||!metode) return alert("Transaksi belum lengkap");
    if(metode==="CASH" && bayar.value<total) return alert("Uang kurang");

    const now=new Date();
    const t=now.toLocaleDateString("id-ID");
    const j=now.toLocaleTimeString("id-ID");

    histori.innerHTML+=`
    <tr><td>${t}</td><td>${j}</td><td>${metode}</td><td>${total}</td></tr>`;

    const file=`kasir-nasi-kuning-51-${now.toISOString().slice(0,10)}.csv`;
    let csv=localStorage.getItem(file)||"Tanggal,Waktu,Metode,Total\n";
    csv+=`${t},${j},${metode},${total}\n`;
    localStorage.setItem(file,csv);

    const a=document.createElement("a");
    a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"}));
    a.download=file;
    a.click();

    reset();
}

function reset(){
    cart.innerHTML="";
    total=0;
    totalSpan.innerText=0;
    bayar.value="";
    kembali.innerText=0;
    metodeSpan.innerText="-";
    metode="";
}
</script>

</body>
</html>
