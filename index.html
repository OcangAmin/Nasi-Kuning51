<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>POS Kasir Nasi Kuning 51</title>
<style>
  :root{
    --primary:#1a73e8;
    --secondary:#34a853;
    --danger:#ea4335;
    --gray:#777;
    --bg:#f2f2f2;
    --btn-height:54px;
  }
  *{ box-sizing:border-box; }
  body{
    margin:0;
    font-family: Arial, sans-serif;
    background:var(--bg);
  }
  .container{
    max-width: 420px;
    margin:0 auto;
    padding:10px;
    padding-bottom: calc(10px + env(safe-area-inset-bottom));
  }
  .header{
    text-align:center;
    padding:12px 0;
    background:#fff;
    border-radius:8px;
    box-shadow:0 1px 4px rgba(0,0,0,0.1);
    margin-bottom:10px;
  }
  .title{
    font-size:18px;
    font-weight:700;
  }
  .subtitle{
    font-size:12px;
    color:#555;
  }

  /* TAB */
  .tabs{
    display:flex;
    gap:8px;
    margin-bottom:10px;
  }
  .tab{
    flex:1;
    padding:10px;
    border-radius:8px;
    border:none;
    cursor:pointer;
    font-weight:700;
  }
  .tab.active{ background:var(--primary); color:#fff; }
  .tab.inactive{ background:#fff; color:#000; border:1px solid #ddd; }

  .section{
    background:#fff;
    border-radius:8px;
    padding:10px;
    margin-bottom:10px;
    box-shadow:0 1px 4px rgba(0,0,0,0.1);
  }
  .section h3{
    margin:0 0 8px 0;
    font-size:14px;
    font-weight:700;
  }

  /* MENU LIST FULL WIDTH */
  .menu-list{
    display:flex;
    flex-direction:column;
    gap:8px;
  }
  .menu-btn{
    padding:14px;
    border:none;
    border-radius:10px;
    font-weight:700;
    font-size:16px;
    cursor:pointer;
    background:var(--primary);
    color:#fff;
    text-align:left;
    display:flex;
    justify-content:space-between;
    align-items:center;
    height: var(--btn-height);
  }
  .menu-btn.secondary{ background:var(--secondary); }
  .menu-btn.danger{ background:var(--danger); }

  /* CART */
  .cart{
    max-height: 240px;
    overflow:auto;
  }
  .cart-item{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:8px 0;
    border-bottom:1px solid #eee;
  }
  .cart-item div{
    display:flex;
    align-items:center;
    gap:8px;
  }
  .qty{
    display:flex;
    align-items:center;
    gap:4px;
  }
  .qty button{
    padding:6px 10px;
    border:none;
    border-radius:6px;
    cursor:pointer;
    font-weight:700;
  }

  /* FOOTER FIXED */
  .footer{
    position: fixed;
    bottom:0;
    left:0;
    right:0;
    background:#fff;
    padding:10px;
    padding-bottom: calc(10px + env(safe-area-inset-bottom));
    box-shadow:0 -2px 8px rgba(0,0,0,0.15);
  }
  .footer .row{
    display:flex;
    gap:8px;
  }
  .footer input[type=number]{
    width:100%;
    padding:12px;
    border-radius:10px;
    border:1px solid #ccc;
    font-size:16px;
  }
  .footer .summary{
    display:flex;
    justify-content:space-between;
    margin-top:8px;
    font-weight:700;
  }
  .footer .btn-grid{
    display:grid;
    grid-template-columns: repeat(3, 1fr);
    gap:8px;
    margin-top:8px;
  }
  .footer .btn{
    padding:12px;
    border:none;
    border-radius:10px;
    cursor:pointer;
    font-weight:700;
    background:var(--primary);
    color:#fff;
    height: var(--btn-height);
  }
  .footer .btn.secondary{ background:var(--secondary); }
  .footer .btn.danger{ background:var(--danger); }
  .footer .btn.gray{ background:#ddd; color:#000; }

  .history{
    max-height: 350px;
    overflow:auto;
  }
  .history-item{
    padding:8px;
    border-bottom:1px solid #eee;
  }
  .history-item div{
    font-size:12px;
  }
  .info{
    font-size:12px;
    color:#555;
    margin-top:6px;
  }

  /* Fix iOS input zoom */
  input, select, textarea {
    font-size: 16px;
  }
</style>
</head>
<body>

<div class="container">

  <div class="header">
    <div class="title">POS Kasir Nasi Kuning 51</div>
    <div class="subtitle">Halilintar Bucek</div>
  </div>

  <!-- TABS -->
  <div class="tabs">
    <button class="tab active" id="tabTransaksi" onclick="showTab('transaksi')">Transaksi</button>
    <button class="tab inactive" id="tabHistory" onclick="showTab('history')">History</button>
  </div>

  <!-- TAB TRANSAKSI -->
  <div id="contentTransaksi">

    <!-- MENU UTAMA -->
    <div class="section">
      <h3>Menu Utama</h3>
      <div class="menu-list">
        <button class="menu-btn" onclick="addItem('Nasi kuning ayam',15000)">Nasi kuning ayam <span>15.000</span></button>
        <button class="menu-btn" onclick="addItem('Nasi kuning ikan',13000)">Nasi kuning ikan <span>13.000</span></button>
        <button class="menu-btn" onclick="addItem('Nasi kuning telur',10000)">Nasi kuning telur <span>10.000</span></button>
        <button class="menu-btn" onclick="addItem('Nasi kuning ayam telur',23000)">Nasi kuning ayam telur <span>23.000</span></button>
        <button class="menu-btn" onclick="addItem('Nasi kuning ikan telur',20000)">Nasi kuning ikan telur <span>20.000</span></button>
      </div>
    </div>

    <!-- MENU ADDITIONAL -->
    <div class="section">
      <h3>Menu Additional</h3>
      <div class="menu-list">
        <button class="menu-btn secondary" onclick="addItem('Ikan',5000)">Ikan <span>5.000</span></button>
        <button class="menu-btn secondary" onclick="addItem('Bakwan',2000)">Bakwan <span>2.000</span></button>
        <button class="menu-btn secondary" onclick="addItem('Nasi',5000)">Nasi <span>5.000</span></button>
        <button class="menu-btn secondary" onclick="addItem('Telur',5000)">Telur <span>5.000</span></button>
        <button class="menu-btn secondary" onclick="addItem('Ayam',5000)">Ayam <span>5.000</span></button>
        <button class="menu-btn secondary" onclick="addItem('Air mineral',5000)">Air mineral <span>5.000</span></button>
      </div>
    </div>

    <!-- CART -->
    <div class="section">
      <h3>Pesanan</h3>
      <div class="cart" id="cart"></div>
      <div class="summary">
        <div>Total Item: <span id="totalItem">0</span></div>
        <div>Total Harga: <span id="totalPrice">0</span></div>
      </div>
    </div>

  </div>

  <!-- TAB HISTORY -->
  <div id="contentHistory" style="display:none;">
    <div class="section">
      <h3>History Penjualan</h3>
      <div class="history" id="history"></div>
      <div class="row" style="margin-top:8px;">
        <button class="btn" onclick="saveHistory()">Simpan History</button>
        <button class="btn danger" onclick="closeCashier()">Tutup Kasir</button>
      </div>
      <div class="row" style="margin-top:8px;">
        <button class="btn gray" onclick="resetHistory()">Reset History</button>
      </div>
      <div class="info">Reset history akan menghapus semua riwayat penjualan.</div>
    </div>
  </div>

</div>

<!-- FOOTER FIXED -->
<div class="footer">
  <div class="row">
    <button class="btn" onclick="setPayment('cash')">CASH</button>
    <button class="btn" onclick="setPayment('qris')">QRIS</button>
  </div>

  <div class="row" style="margin-top:8px;">
    <input id="paid" type="number" placeholder="Uang Bayar" inputmode="numeric" oninput="calc()">
    <button class="btn gray" onclick="clearPaid()">Clear</button>
  </div>

  <div class="btn-grid">
    <button class="btn gray" onclick="addPaid(5000)">5K</button>
    <button class="btn gray" onclick="addPaid(10000)">10K</button>
    <button class="btn gray" onclick="addPaid(20000)">20K</button>
    <button class="btn gray" onclick="addPaid(50000)">50K</button>
    <button class="btn gray" onclick="addPaid(100000)">100K</button>
    <button class="btn gray" onclick="setPaidExact()">Uang Pas</button>
  </div>

  <div class="summary">
    <div>Status: <span id="status">Belum ada pesanan</span></div>
    <div>Kembalian: <span id="change">0</span></div>
  </div>

  <div class="row" style="margin-top:8px;">
    <button class="btn secondary" onclick="finishTransaction()">Selesaikan</button>
    <button class="btn gray" onclick="resetTransaction()">Reset</button>
  </div>
</div>

<script>
  let cart = [];
  let history = [];
  let paymentMethod = null;

  function showTab(tab){
    if(tab === "transaksi"){
      document.getElementById("contentTransaksi").style.display = "block";
      document.getElementById("contentHistory").style.display = "none";
      document.getElementById("tabTransaksi").classList.add("active");
      document.getElementById("tabTransaksi").classList.remove("inactive");
      document.getElementById("tabHistory").classList.add("inactive");
      document.getElementById("tabHistory").classList.remove("active");
    } else {
      document.getElementById("contentTransaksi").style.display = "none";
      document.getElementById("contentHistory").style.display = "block";
      document.getElementById("tabTransaksi").classList.add("inactive");
      document.getElementById("tabTransaksi").classList.remove("active");
      document.getElementById("tabHistory").classList.add("active");
      document.getElementById("tabHistory").classList.remove("inactive");
    }
  }

  function loadData(){
    cart = JSON.parse(localStorage.getItem("bucek_cart")) || [];
    history = JSON.parse(localStorage.getItem("bucek_history")) || [];
    renderCart();
    renderHistory();
  }

  function saveData(){
    localStorage.setItem("bucek_cart", JSON.stringify(cart));
    localStorage.setItem("bucek_history", JSON.stringify(history));
  }

  function addItem(name, price){
    let idx = cart.findIndex(x => x.name === name);
    if(idx >= 0){
      cart[idx].qty++;
    } else {
      cart.push({name, price, qty:1});
    }
    renderCart();
    calc();
    saveData();
  }

  function removeItem(name){
    cart = cart.filter(x => x.name !== name);
    renderCart();
    calc();
    saveData();
  }

  function changeQty(name, delta){
    let idx = cart.findIndex(x => x.name === name);
    if(idx < 0) return;
    cart[idx].qty += delta;
    if(cart[idx].qty < 1) cart[idx].qty = 1;
    renderCart();
    calc();
    saveData();
  }

  function renderCart(){
    let html = "";
    let totalItem = 0;
    let totalPrice = 0;
    cart.forEach(item => {
      totalItem += item.qty;
      totalPrice += item.qty * item.price;
      html += `
        <div class="cart-item">
          <div>
            <strong>${item.name}</strong>
            <div class="qty">
              <button onclick="changeQty('${item.name}', -1)">-</button>
              <span>${item.qty}</span>
              <button onclick="changeQty('${item.name}', 1)">+</button>
            </div>
          </div>
          <div>
            <span>${item.qty * item.price}</span>
            <button class="btn gray" onclick="removeItem('${item.name}')">X</button>
          </div>
        </div>
      `;
    });
    document.getElementById("cart").innerHTML = html;
    document.getElementById("totalItem").innerText = totalItem;
    document.getElementById("totalPrice").innerText = totalPrice;
  }

  function setPayment(method){
    paymentMethod = method;
    if(method === "qris"){
      document.getElementById("paid").value = document.getElementById("totalPrice").innerText;
    }
    calc();
  }

  function addPaid(amount){
    let paidInput = document.getElementById("paid");
    let val = Number(paidInput.value || 0);
    paidInput.value = val + amount;
    calc();
  }

  function setPaidExact(){
    let total = Number(document.getElementById("totalPrice").innerText);
    document.getElementById("paid").value = total;
    calc();
  }

  function clearPaid(){
    document.getElementById("paid").value = "";
    calc();
  }

  function calc(){
    let total = Number(document.getElementById("totalPrice").innerText);
    let paid = Number(document.getElementById("paid").value || 0);

    if(cart.length === 0){
      document.getElementById("status").innerText = "Belum ada pesanan";
      document.getElementById("change").innerText = 0;
      return;
    }

    if(!paymentMethod){
      document.getElementById("status").innerText = "Pilih metode pembayaran";
      document.getElementById("change").innerText = 0;
      return;
    }

    if(paid < total){
      document.getElementById("status").innerText = "Uang kurang";
      document.getElementById("change").innerText = 0;
      return;
    }

    document.getElementById("status").innerText = "Siap bayar";
    document.getElementById("change").innerText = paid - total;
  }

  function finishTransaction(){
    let total = Number(document.getElementById("totalPrice").innerText);
    let paid = Number(document.getElementById("paid").value || 0);
    let change = Number(document.getElementById("change").innerText || 0);

    if(cart.length === 0){
      alert("Belum ada pesanan!");
      return;
    }
    if(!paymentMethod){
      alert("Pilih metode pembayaran!");
      return;
    }
    if(paid < total){
      alert("Uang tidak mencukupi!");
      return;
    }

    let now = new Date();
    let timestamp = now.toLocaleString();

    history.push({
      time: timestamp,
      items: JSON.parse(JSON.stringify(cart)),
      total,
      method: paymentMethod,
      paid,
      change
    });

    cart = [];
    paymentMethod = null;
    document.getElementById("paid").value = "";
    renderCart();
    renderHistory();
    calc();
    saveData();

    alert("Transaksi berhasil disimpan!");
  }

  function resetTransaction(){
    if(cart.length === 0){
      alert("Tidak ada transaksi untuk di-reset.");
      return;
    }

    let confirmReset = confirm("Yakin ingin reset transaksi saat ini? Data pesanan akan hilang.");
    if(!confirmReset) return;

    cart = [];
    paymentMethod = null;
    document.getElementById("paid").value = "";
    renderCart();
    calc();
    saveData();
  }

  function renderHistory(){
    let html = "";
    history.forEach((h, idx) => {
      let itemList = h.items.map(i => `${i.name} x${i.qty}`).join(", ");
      html += `
        <div class="history-item">
          <div><strong>#${idx+1} - ${h.time}</strong></div>
          <div>${itemList}</div>
          <div>Total: ${h.total} | Bayar: ${h.paid} | Kembali: ${h.change} | Metode: ${h.method.toUpperCase()}</div>
        </div>
      `;
    });
    document.getElementById("history").innerHTML = html;
  }

  function saveHistory(){
    if(history.length === 0){
      alert("Belum ada history transaksi!");
      return;
    }

    let text = "HISTORY TRANSAKSI\n\n";
    history.forEach((h, idx) => {
      let itemList = h.items.map(i => `${i.name} x${i.qty}`).join(", ");
      text += `#${idx+1} | ${h.time}\n`;
      text += `Items: ${itemList}\n`;
      text += `Total: ${h.total} | Bayar: ${h.paid} | Kembali: ${h.change} | Metode: ${h.method.toUpperCase()}\n\n`;
    });

    let blob = new Blob([text], {type:"text/plain"});
    let link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = `bucek_history_${new Date().getTime()}.txt`;
    link.click();
    URL.revokeObjectURL(link.href);
  }

  function resetHistory(){
    if(history.length === 0){
      alert("History kosong.");
      return;
    }

    let confirmReset = confirm("Yakin ingin reset semua history? Data riwayat akan hilang.");
    if(!confirmReset) return;

    history = [];
    saveData();
    renderHistory();
  }

  function closeCashier(){
    if(history.length === 0){
      alert("Belum ada transaksi untuk ditutup!");
      return;
    }

    let now = new Date();
    let filename = `bucek_tutup_kasir_${now.getFullYear()}-${now.getMonth()+1}-${now.getDate()}_${now.getHours()}-${now.getMinutes()}-${now.getSeconds()}.txt`;

    let text = "TUTUP KASIR\n\n";
    text += `Tanggal: ${now.toLocaleString()}\n`;
    text += `Total Transaksi: ${history.length}\n\n`;
    history.forEach((h, idx) => {
      let itemList = h.items.map(i => `${i.name} x${i.qty}`).join(", ");
      text += `#${idx+1} | ${h.time}\n`;
      text += `Items: ${itemList}\n`;
      text += `Total: ${h.total} | Bayar: ${h.paid} | Kembali: ${h.change} | Metode: ${h.method.toUpperCase()}\n\n`;
    });

    let blob = new Blob([text], {type:"text/plain"});
    let link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = filename;
    link.click();
    URL.revokeObjectURL(link.href);

    history = [];
    saveData();
    renderHistory();
    alert("Kasir ditutup dan history ter-reset.");
  }

  loadData();
  calc();
</script>

</body>
</html>
